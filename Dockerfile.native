FROM ghcr.io/graalvm/graalvm-community:17-ol9@sha256:eac1619df619a6ac24333d3be635d10a217b1bb3aa04ca1485b0e29a011d460a AS builder

WORKDIR /build
COPY . .

RUN ./mvnw clean package -Pnative -DskipTests

FROM ubuntu:noble-20231221@sha256:38d380071057443ebb6d65566c03a98eaec411e84e04e5e16cff49b1d6fdc9a0 AS cve
COPY --from=builder /build/target/rtd-ms-file-register*.jar .

FROM ubuntu:noble-20231221@sha256:38d380071057443ebb6d65566c03a98eaec411e84e04e5e16cff49b1d6fdc9a0 AS runtime

EXPOSE 8080

RUN useradd --uid 10000 runner
USER 10000

COPY --from=builder /build/target/rtd-ms-file-register .

ENTRYPOINT ["./rtd-ms-file-register"]